<mat-tab-group>

  <mat-tab label="Columns">
    <mat-selection-list [(ngModel)]="columns">
      <mat-list-option *ngFor="let field of descriptor?.dto?.fields || []" [value]="field.reference">{{ (this.reference.id + '.' + field.reference) | transloco }}</mat-list-option>
    </mat-selection-list>
  </mat-tab>

  <mat-tab label="Filter">
    <mat-tree [treeControl]="treeControl" [dataSource]="dataSource" class="filter">

      <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>

        <ng-container *ngIf="node.type == 'STATEMENT'">
          <mat-form-field appearance="outline" class="reference-field">
            <mat-label>Field</mat-label>
            <mat-select [(ngModel)]="node.reference">
              <mat-option *ngFor="let field of fields" [value]="field">{{field}}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="operator-field">
            <mat-label>Operator</mat-label>
            <mat-select [(ngModel)]="node.operator">
              <mat-option *ngFor="let operator of operators" [value]="operator">{{operator}}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="value-field">
            <mat-label>Value</mat-label>
            <input matInput [(ngModel)]="node.value">
          </mat-form-field>

          <span class="spacer"></span>

          <button mat-button (click)="wrapExpression(node)"><mat-icon>code</mat-icon></button>
          <button mat-button (click)="removeExpression(node)"><mat-icon>remove</mat-icon></button>
        </ng-container>

        <ng-container *ngIf="node.type != 'STATEMENT'">
          <span>{{ 'filter.expression.type.' + node.type | transloco }}</span>
          <span class="spacer"></span>

          <button mat-button (click)="wrapExpression(node)"><mat-icon>code</mat-icon></button>
          <button mat-button (click)="addExpression(node)"><mat-icon>add</mat-icon></button>
          <button mat-button (click)="removeExpression(node)"><mat-icon>remove</mat-icon></button>
        </ng-container>

      </mat-tree-node>

      <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">

        <div class="node-container">
          <button mat-button matTreeNodeToggle>
            <mat-icon>{{ treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right' }}</mat-icon>
          </button>

          <span>{{ 'filter.expression.type.' + node.type | transloco }}</span>
          <span class="spacer"></span>

          <button mat-button (click)="wrapExpression(node)"><mat-icon>code</mat-icon></button>
          <button mat-button (click)="addExpression(node)"><mat-icon>add</mat-icon></button>
          <button mat-button (click)="removeExpression(node)"><mat-icon>remove</mat-icon></button>

        </div>

        <div [class.invisible]="!treeControl.isExpanded(node)" class="nested">
          <ng-container matTreeNodeOutlet></ng-container>
        </div>

      </mat-nested-tree-node>

    </mat-tree>
  </mat-tab>

</mat-tab-group>
